<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>WebScreen</title>
    <link rel="stylesheet" href="/static/css/index.css">
    <script src="/static/i18n.js"></script>
</head>

<body>
    <div class="main-container">
        <div class="video-container">
            <video id="remoteVideo" autoplay muted playsinline></video>
        </div>
        <div class="controls-container">
            <a href="/console" class="control-btn" data-i18n-title="device_manager" title="设备管理" style="text-decoration: none;">
                <svg viewBox="0 0 24 24" width="24" height="24" fill="currentColor"><path d="M3 13h2v-2H3v2zm0 4h2v-2H3v2zm0-8h2V7H3v2zm4 4h14v-2H7v2zm0 4h14v-2H7v2zM7 7v2h14V7H7z"/></svg>
            </a>
            <button onclick="start()" class="control-btn primary" data-i18n-title="reconnect" title="连接(重新连接)">
                <svg viewBox="0 0 24 24" width="24" height="24" fill="currentColor"><path d="M17.65 6.35C16.2 4.9 14.21 4 12 4c-4.42 0-7.99 3.58-7.99 8s3.57 8 7.99 8c3.73 0 6.84-2.55 7.73-6h-2.08c-.82 2.33-3.04 4-5.65 4-3.31 0-6-2.69-6-6s2.69-6 6-6c1.66 0 3.14.69 4.22 1.78L13 11h7V4l-2.35 2.35z"/></svg>
            </button>
            <button onclick="fullscreenPlayer()" class="control-btn" data-i18n-title="fullscreen" title="全屏">
                <svg viewBox="0 0 24 24" width="24" height="24" fill="currentColor"><path d="M7 14H5v5h5v-2H7v-3zm-2-4h2V7h3V5H5v5zm12 7h-3v2h5v-5h-2v3zM14 5v2h3v3h2V5h-5z"/></svg>
            </button>
            <div class="separator feature-control" style="display: none;"></div>
            <button onmousedown="pressButton(24)" onmouseup="releaseButton(24)" onmouseleave="releaseButton(24)" ontouchstart="pressButton(24)" ontouchend="releaseButton(24)" class="control-btn feature-control" data-i18n-title="volume_up" title="音量+" style="display: none;">
                <svg viewBox="0 0 24 24" width="24" height="24" fill="currentColor"><path d="M3 9v6h4l5 5V4L7 9H3zm13.5 3c0-1.77-1.02-3.29-2.5-4.03v8.05c1.48-.73 2.5-2.25 2.5-4.02zM14 3.23v2.06c2.89.86 5 3.54 5 6.71s-2.11 5.85-5 6.71v2.06c4.01-.91 7-4.49 7-8.77s-2.99-7.86-7-8.77z"/></svg>
            </button>
            <button onmousedown="pressButton(25)" onmouseup="releaseButton(25)" onmouseleave="releaseButton(25)" ontouchstart="pressButton(25)" ontouchend="releaseButton(25)" class="control-btn feature-control" data-i18n-title="volume_down" title="音量-" style="display: none;">
                <svg viewBox="0 0 24 24" width="24" height="24" fill="currentColor"><path d="M18.5 12c0-1.77-1.02-3.29-2.5-4.03v8.05c1.48-.73 2.5-2.25 2.5-4.02zM5 9v6h4l5 5V4L9 9H5z"/></svg>
            </button>
            <button onmousedown="pressButton(26)" onmouseup="releaseButton(26)" onmouseleave="releaseButton(26)" ontouchstart="pressButton(26)" ontouchend="releaseButton(26)" class="control-btn feature-control" data-i18n-title="power" title="电源" style="display: none;">
                <svg viewBox="0 0 24 24" width="24" height="24" fill="currentColor"><path d="M13 3h-2v10h2V3zm4.83 2.17l-1.42 1.42C17.99 7.86 19 9.81 19 12c0 3.87-3.13 7-7 7s-7-3.13-7-7c0-2.19 1.01-4.14 2.58-5.42L6.17 5.17C4.23 6.82 3 9.26 3 12c0 4.97 4.03 9 9 9s9-4.03 9-9c0-2.74-1.23-5.18-3.17-6.83z"/></svg>
            </button>
            <div class="separator feature-control" style="display: none;"></div>
            <button onclick="backButton()" class="control-btn feature-control" data-i18n-title="back" title="返回" style="display: none;">
                <svg viewBox="0 0 24 24" width="24" height="24" fill="currentColor"><path d="M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20v-2z"/></svg>
            </button>
            <button onclick="homeButton()" class="control-btn feature-control" data-i18n-title="home" title="主页" style="display: none;">
                <svg viewBox="0 0 24 24" width="24" height="24" fill="currentColor"><path d="M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z"/></svg>
            </button>
            <button onclick="menuButton()" class="control-btn feature-control" data-i18n-title="menu" title="菜单" style="display: none;">
                <svg viewBox="0 0 24 24" width="24" height="24" fill="currentColor"><path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/></svg>
            </button>
            <div class="separator feature-control" style="display: none;"></div>
            <button onclick="rotateButton()" class="control-btn feature-control" data-i18n-title="rotate" title="旋转" style="display: none;">
                <svg viewBox="0 0 24 24" width="24" height="24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M4 3h7v7h7v7H4z" />
                    <path d="M4 10h7v7" />
                    <path d="M13 3a7 7 0 0 1 7 7" />
                    <path d="M16 3h-3v3" />
                    <path d="M20 7v3h-3" />
                </svg>
            </button>
            <!-- <button onclick="getClipboard()" class="control-btn feature-clipboard" title="获取剪贴板 (Device -> Browser)" style="display: none;">
                <svg viewBox="0 0 24 24" width="24" height="24" fill="currentColor"><path d="M19 2h-4.18C14.4.84 13.3 0 12 0c-1.3 0-2.4.84-2.82 2H5c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zm-7 0c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1zm7 18H5V4h2v3h10V4h2v16z"/></svg>
            </button> -->
            <button onclick="navigator.clipboard.readText().then(text => setClipboard(text))" class="control-btn feature-clipboard" data-i18n-title="set_clipboard" title="设置剪贴板 (Browser -> Device)" style="display: none;">
                <svg viewBox="0 0 24 24" width="24" height="24" fill="currentColor"><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"/></svg>
            </button>
            <div class="separator feature-uhid" style="display: none;"></div>            
            <button onclick="toggleUHIDMouse()" class="control-btn feature-uhid" id="uhidToggleBtn" data-i18n-title="mouse_mode" title="鼠标模式" style="display: none;">
                <svg viewBox="0 0 24 24" width="24" height="24" fill="currentColor"><path d="M13 1.07V9h7c0-4.08-3.05-7.44-7-7.93zM4 15c0 4.42 3.58 8 8 8s8-3.58 8-8v-4H4v4zm7-13.93C7.05 1.56 4 4.92 4 9h7V1.07z"/></svg>
            </button>
            <button onclick="toggleUHIDKeyboard()" class="control-btn feature-uhid" id="uhidKeyboardToggleBtn" data-i18n-title="keyboard_mode" title="键盘模式" style="display: none;">
                <svg viewBox="0 0 24 24" width="24" height="24" fill="currentColor"><path d="M20 5H4c-1.1 0-1.99.9-1.99 2L2 17c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm-9 3h2v2h-2V8zm0 3h2v2h-2v-2zM8 8h2v2H8V8zm0 3h2v2H8v-2zm-1 2H5v-2h2v2zm0-3H5V8h2v2zm9 7H8v-2h8v2zm0-4h-2v-2h2v2zm0-3h-2V8h2v2zm3 3h-2v-2h2v2zm0-3h-2V8h2v2z"/></svg>
            </button>
            <button onclick="toggleUHIDGamepad()" class="control-btn feature-uhid" id="uhidGamepadToggleBtn" data-i18n-title="gamepad_mode" title="手柄模式" style="display: none;">
                <svg viewBox="0 0 24 24" width="24" height="24" fill="currentColor"><path d="M21 6H3c-1.1 0-2 .9-2 2v8c0 1.1.9 2 2 2h18c1.1 0 2-.9 2-2V8c0-1.1-.9-2-2-2zm-10 7H8v3H6v-3H3v-2h3V8h2v3h3v2zm4.5 2c-.83 0-1.5-.67-1.5-1.5s.67-1.5 1.5-1.5 1.5.67 1.5 1.5-.67 1.5-1.5 1.5zm4-3c-.83 0-1.5-.67-1.5-1.5S18.67 9 19.5 9s1.5.67 1.5 1.5-.67 1.5-1.5 1.5z"/></svg>
            </button>
        </div>
    </div>
    <script>
        var MANNUAL_ROTATE = false

        // Debounce/Throttle check
        let checkTimeout;
        function triggerCheck() {
            clearTimeout(checkTimeout);
            checkTimeout = setTimeout(checkOrientation, 500);
        }

        window.addEventListener('resize', triggerCheck);

        function checkOrientation() {
            if (MANNUAL_ROTATE) {
                // console.log("Manual rotate detected, skipping auto-rotate.");
                return;
            }
            const video = document.getElementById('remoteVideo');
            if (!video.videoWidth || !video.videoHeight) return;

            const isPagePortrait = window.innerHeight > window.innerWidth;
            const isVideoLandscape = video.videoWidth > video.videoHeight;

            const isPageLandscape = window.innerWidth > window.innerHeight;
            const isVideoPortrait = video.videoHeight > video.videoWidth;

            if (isPagePortrait && isVideoLandscape) {
                // console.log("Auto-rotating: Page Portrait, Video Landscape");
                p = createRotatePacket();
                sendButtonEvent(p);
            } else if (isPageLandscape && isVideoPortrait) {
                // console.log("Auto-rotating: Page Landscape, Video Portrait");
                p = createRotatePacket();
                sendButtonEvent(p);
            }
        }
        window.onload = () => {
            start()
        }
    </script>
    <!-- ------------ -->
    <script src="/static/connect.js"></script>
    <script src="/static/ui.js"></script>
    <script src="/static/fullscreen.js"></script>

    <!-- <script src="/static/controlMessages.js"></script>
    <script src="/static/keyboard.js"></script>
    <script src="/static/buttons.js"></script>
    <script src="/static/touch.js"></script>
    <script src="/static/scroll.js"></script>

    <script src="/static/uhid_mouse.js"></script>
    <script src="/static/uhid_keyboard.js"></script>
    <script src="/static/uhid_gamepad.js"></script> -->
    
    
</body>

</html>