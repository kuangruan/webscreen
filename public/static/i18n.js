const translations = {
    en: {
        app_title: "WebScreen Console",
        refresh: "Refresh",
        connected_devices: "Connected Devices",
        manage_devices_subtitle: "Manage and stream your Android devices",
        wireless_pair: "Wireless Pair",
        connect_device: "Connect Device",
        scanning_devices: "Scanning devices...",
        no_devices: "No devices connected",
        connect_new_device: "Connect New Device",
        ip_address: "IP Address",
        port_default: "Port (Default 5555)",
        cancel: "Cancel",
        connect: "Connect",
        wireless_pair_title: "Wireless Pair",
        port_wireless: "Port (Wireless Debugging Port)",
        pair_code: "Pairing Code (6 digits)",
        pair: "Pair",
        configure_device: "Configure Device",
        configure_subtitle: "Set streaming parameters",
        max_fps: "Max FPS",
        bitrate: "Bitrate (Mbps)",
        video_codec: "Video Codec",
        h264_recommended: "H.264 (Recommended)",
        h265_efficient: "H.265 (Efficient)",
        codec_options_placeholder: "e.g. i-frame-interval=10",
        new_display: "New Display",
        leave_empty_disable: "Leave empty to disable",
        save_settings: "Save Settings",
        refreshed_found: "Refreshed: Found {n} devices",
        demo_mode: "Demo Mode: Using mock data",
        enter_ip: "Please enter IP address",
        connected_success: "Connected successfully!",
        connection_failed: "Connection failed",
        api_failed_demo: "API Request Failed (Demo Mode)",
        fill_all_fields: "Please fill all fields",
        pair_success: "Pairing successful! You can connect now",
        pair_failed: "Pairing request failed",
        starting_stream: "Starting stream...",
        config_saved: "Configuration saved",
        default_config: "Default Config",
        start_stream: "Start Stream",
        device_manager: "Device Manager",
        reconnect: "Connect (Reconnect)",
        fullscreen: "Fullscreen",
        volume_up: "Volume +",
        volume_down: "Volume -",
        power: "Power",
        back: "Back",
        home: "Home",
        menu: "Menu",
        rotate: "Rotate",
        set_clipboard: "Set Clipboard (Browser -> Device)",
        mouse_mode: "Mouse Mode",
        keyboard_mode: "Keyboard Mode",
        gamepad_mode: "Gamepad Mode",
        video: "Video",
        display: "Display",
        config_device_title: "Configure {serial}",
        video_codec_options: "video_codec_options",
        error_from_server: "Error from server: {msg}"
    },
    zh: {
        app_title: "WebScreen 控制台",
        refresh: "刷新",
        connected_devices: "已连接设备",
        manage_devices_subtitle: "管理和串流您的 Android 设备",
        wireless_pair: "无线配对",
        connect_device: "连接设备",
        scanning_devices: "正在扫描设备...",
        no_devices: "未连接设备",
        connect_new_device: "连接新设备",
        ip_address: "IP 地址",
        port_default: "端口 (默认 5555)",
        cancel: "取消",
        connect: "连接",
        wireless_pair_title: "无线配对",
        port_wireless: "端口 (无线调试端口)",
        pair_code: "配对码 (6位)",
        pair: "配对",
        configure_device: "配置设备",
        configure_subtitle: "设置流传输参数",
        max_fps: "最大 FPS",
        bitrate: "比特率 (Mbps)",
        video_codec: "视频编码",
        h264_recommended: "H.264 (推荐)",
        h265_efficient: "H.265 (高效)",
        codec_options_placeholder: "例如: i-frame-interval=10",
        new_display: "New Display",
        leave_empty_disable: "留空以禁用此选项",
        save_settings: "保存设置",
        refreshed_found: "已刷新: 发现 {n} 台设备",
        demo_mode: "演示模式: 使用模拟数据",
        enter_ip: "请输入 IP 地址",
        connected_success: "连接成功!",
        connection_failed: "连接失败",
        // api_failed_demo: "API 请求失败 (演示模式)",
        fill_all_fields: "请填写所有字段",
        pair_success: "配对成功! 现在可以连接了",
        pair_failed: "配对请求失败",
        starting_stream: "正在启动串流...",
        config_saved: "配置已保存",
        default_config: "默认配置",
        start_stream: "开始投屏",
        device_manager: "设备管理",
        reconnect: "连接(重新连接)",
        fullscreen: "全屏",
        volume_up: "音量+",
        volume_down: "音量-",
        power: "电源",
        back: "返回",
        home: "主页",
        menu: "菜单",
        rotate: "旋转",
        set_clipboard: "设置剪贴板 (Browser -> Device)",
        mouse_mode: "UHID鼠标",
        keyboard_mode: "UHID键盘",
        gamepad_mode: "手柄",
        video: "视频",
        display: "显示",
        config_device_title: "配置 {serial}",
        video_codec_options: "video_codec_options",
        error_from_server: "服务器错误: {msg}"
    },
    ja: {
        app_title: "WebScreen コンソール",
        refresh: "更新",
        connected_devices: "接続済みデバイス",
        manage_devices_subtitle: "Androidデバイスの管理とストリーミング",
        wireless_pair: "ワイヤレスペアリング",
        connect_device: "デバイス接続",
        scanning_devices: "デバイスをスキャン中...",
        no_devices: "デバイスが接続されていません",
        connect_new_device: "新しいデバイスを接続",
        ip_address: "IPアドレス",
        port_default: "ポート (デフォルト 5555)",
        cancel: "キャンセル",
        connect: "接続",
        wireless_pair_title: "ワイヤレスペアリング",
        port_wireless: "ポート (ワイヤレスデバッグポート)",
        pair_code: "ペアリングコード (6桁)",
        pair: "ペアリング",
        configure_device: "デバイス設定",
        configure_subtitle: "ストリーミングパラメータの設定",
        max_fps: "最大 FPS",
        bitrate: "ビットレート (Mbps)",
        video_codec: "ビデオコーデック",
        h264_recommended: "H.264 (推奨)",
        h265_efficient: "H.265 (高効率)",
        codec_options_placeholder: "例: i-frame-interval=10",
        new_display: "新しいディスプレイ",
        leave_empty_disable: "無効にする場合は空欄",
        save_settings: "設定を保存",
        refreshed_found: "更新完了: {n} 台のデバイスが見つかりました",
        demo_mode: "デモモード: モックデータを使用中",
        enter_ip: "IPアドレスを入力してください",
        connected_success: "接続成功!",
        connection_failed: "接続失敗",
        api_failed_demo: "APIリクエスト失敗 (デモモード)",
        fill_all_fields: "すべてのフィールドを入力してください",
        pair_success: "ペアリング成功! 接続可能です",
        pair_failed: "ペアリング要求失敗",
        starting_stream: "ストリーミングを開始中...",
        config_saved: "設定を保存しました",
        default_config: "デフォルト設定",
        start_stream: "ストリーミング開始",
        device_manager: "デバイス管理",
        reconnect: "接続 (再接続)",
        fullscreen: "全画面",
        volume_up: "音量 +",
        volume_down: "音量 -",
        power: "電源",
        back: "戻る",
        home: "ホーム",
        menu: "メニュー",
        rotate: "回転",
        set_clipboard: "クリップボード設定 (Browser -> Device)",
        mouse_mode: "マウスモード",
        keyboard_mode: "キーボードモード",
        gamepad_mode: "ゲームパッドモード",
        video: "ビデオ",
        display: "ディスプレイ",
        config_device_title: "{serial} の設定",
        video_codec_options: "video_codec_options",
        error_from_server: "サーバーエラー: {msg}"
    }
};

class I18n {
    constructor() {
        this.lang = localStorage.getItem('webscreen_lang') || navigator.language.slice(0, 2);
        if (!['en', 'zh', 'ja'].includes(this.lang)) {
            this.lang = 'en';
        }
        // Initial apply will be called manually or on DOMContentLoaded
    }

    setLang(lang) {
        if (!translations[lang]) return;
        this.lang = lang;
        localStorage.setItem('webscreen_lang', lang);
        this.apply();
    }

    t(key, params = {}) {
        let str = translations[this.lang]?.[key] || translations['en']?.[key] || key;
        Object.keys(params).forEach(k => {
            str = str.replace(`{${k}}`, params[k]);
        });
        return str;
    }

    apply() {
        document.querySelectorAll('[data-i18n]').forEach(el => {
            const key = el.getAttribute('data-i18n');
            if (el.tagName === 'INPUT' && el.getAttribute('placeholder')) {
                 el.setAttribute('placeholder', this.t(key));
            } else {
                 el.textContent = this.t(key);
            }
        });
        
        document.querySelectorAll('[data-i18n-title]').forEach(el => {
            const key = el.getAttribute('data-i18n-title');
            el.setAttribute('title', this.t(key));
        });

        // Update active state of language buttons if they exist
        document.querySelectorAll('.lang-btn').forEach(btn => {
            if (btn.dataset.lang === this.lang) {
                btn.classList.add('active', 'text-[var(--md-sys-color-primary)]', 'font-bold');
                btn.classList.remove('text-gray-400');
            } else {
                btn.classList.remove('active', 'text-[var(--md-sys-color-primary)]', 'font-bold');
                btn.classList.add('text-gray-400');
            }
        });
    }
}

const i18n = new I18n();

// Auto-apply on load
document.addEventListener('DOMContentLoaded', () => {
    i18n.apply();
});
